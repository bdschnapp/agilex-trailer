amcl:
  ros__parameters:
    use_map_topic: true
    map_topic: /map
    tf_broadcast: true
    base_frame_id: base_link
    odom_frame_id: odom
    global_frame_id: map
    laser_min_range: 0.05
    laser_max_range: 80.0
    min_particles: 300
    max_particles: 2000
    update_min_d: 0.05
    update_min_a: 0.05

ekf_localization_node:
  ros__parameters:
    frequency: 50
    two_d_mode: true
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link
    world_frame: odom
    # Inputs
    odom0: /wheel_odom
    imu0: /imu
    imu0_differential: false
    imu0_remove_gravitational_acceleration: true
    publish_tf: true

planner_server:
  ros__parameters:
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_smac_planner/SmacPlannerHybrid"
      tolerance: 0.25
      allow_unknown: false
      cost_travel_multiplier: 1.0
      minimum_turning_radius: 6.0     # set to your truckâ€™s min R (m)
      reverse: true                   # enable if you want backing up
      angle_quantization_bins: 72

controller_server:
  ros__parameters:
    use_sim_time: true
    controller_frequency: 20.0
    costmap_update_timeout: 0.30
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    use_realtime_priority: false
    speed_limit_topic: "speed_limit"

    # Topic Nav2 publishes Twist to (remap in launch if you need)
    cmd_vel_topic: "/ackermann_like_controller/cmd_vel"

    # plugin lists
    progress_checker_plugins:
      - progress_checker
    goal_checker_plugins:
      - general_goal_checker
    controller_plugins:
      - FollowPath

    # Progress checker
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0

    # Goal checker
    general_goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: true

    # Regulated Pure Pursuit controller (Ackermann-friendly)
    FollowPath:
      plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
      desired_linear_vel: 1.0
      max_linear_accel: 1.5
      lookahead_dist: 1.5
      use_velocity_scaled_lookahead_dist: true
      min_lookahead_dist: 0.6
      max_lookahead_dist: 3.0
      use_rotate_to_heading: false
      allow_reversing: true
      regulate_forward_speed: true
      transform_tolerance: 0.2
      curvature_lookahead_dist: 1.2
      use_interpolation: true

local_costmap:
  ros__parameters:
    footprint: "[[0.6, 0.4], [0.6, -0.4], [-0.6, -0.4], [-0.6, 0.4]]"
    plugins: ["static_layer", "voxel_layer", "inflation_layer"]
    voxel_layer:
      plugin: "nav2_costmap_2d::VoxelLayer"
      observation_sources: lidar
      lidar:
        topic: /rslidar_points
        clearing: true
        marking: true
        data_type: PointCloud2
        min_obstacle_height: -0.2
        max_obstacle_height: 2.0
      z_voxels: 16
      z_resolution: 0.15

bt_navigator:
  ros__parameters:
    default_nav_to_pose_bt_xml: "navigate_to_pose_w_replanning_and_recovery.xml"
